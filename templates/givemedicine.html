{% extends "base.html" %}
{% block content %}
<div class="nk-content">
    <div class="container-fluid">
        <div class="nk-content-inner">
            <div class="nk-content-body">
                <div class="nk-block-head nk-block-head-sm">
                    <div class="nk-block-between">
                        <div class="nk-block-head-content">
                            <h3 class="nk-block-title page-title">Dori chiqarish</h3>
                        </div>
                    </div>
                </div>

                <form method="post">
                    {% csrf_token %}
                    <div class="nk-block">
                        <div class="card card-bordered">
                            <div class="card-inner">
                                <div class="row gy-4">

                                    <!-- Dori nomi -->
                                    <div class="col-xxl-4 col-md-6">
                                        <div class="form-group">
                                            <label class="form-label" for="name">Dori Nomi</label>
                                            <select class="form-select" id="name" name="name" required>
                                                <option value="">Dori tanlang</option>
                                                {% for med in medicines %}
                                                    <option value="{{ med.name }}">
                                                        {{ med.name }} ({{ med.category }}) 
                                                        - {{ med.quantity }} quti ({{ med.total_units }} dona)
                                                    </option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                    </div>


                                    <!-- Sotish turi -->
                                    <div class="col-xxl-4 col-md-6">
                                        <div class="form-group">
                                            <label class="form-label" for="sale_type">Sotish turi</label>
                                            <select class="form-select js-select2" name="sale_type" id="sale_type" data-theme="bootstrap-5" required>
                                                <option value="">Tanlang</option>
                                                <option value="box">Quti (pochka)</option>
                                                <option value="unit">Dona</option>
                                            </select>
                                        </div>
                                    </div>

                                    <!-- Miqdor -->
                                    <div class="col-xxl-4 col-md-6">
                                        <div class="form-group">
                                            <label class="form-label" for="quantity" id="quantity_label">Miqdor</label>
                                            <input type="number" class="form-control" id="quantity" name="quantity" min="1" required placeholder="Miqdor">
                                        </div>
                                    </div>

                                    <!-- Joy tanlash -->
                                    <div class="col-xxl-4 col-md-6">
                                        <div class="form-group">
                                            <label class="form-label" for="place">Joyni tanlang</label>
                                            <select class="form-select js-select2" id="place" name="place" data-theme="bootstrap-5" required>
                                                <option value="">Joyni tanlang</option>
                                                {% for place in places %}
                                                    <option value="{{ place.id }}">{{ place.name }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                    </div>

                                    <!-- Submit -->
                                    <div class="col-12">
                                        <div class="form-group">
                                            <button type="submit" class="btn btn-primary">Tasdiqlash</button>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                </form>

            </div>
        </div>
    </div>
</div>

<!-- Select2 kutubxonalari -->
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" rel="stylesheet" />

<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function () {
    // Miqdor labelini oâ€˜zgartirish
    document.getElementById("sale_type").addEventListener("change", function() {
        let label = document.getElementById("quantity_label");
        if (this.value === "box") {
            label.textContent = "Miqdor (quti soni)";
        } else if (this.value === "unit") {
            label.textContent = "Miqdor (dona soni)";
        } else {
            label.textContent = "Miqdor";
        }
    });

    // Select2 ishga tushirish
    $('#name').select2({
        placeholder: "Dori tanlang",
        allowClear: true,
        theme: "bootstrap-5",
        minimumResultsForSearch: 0  // qidirish har doim bo'ladi
    });

    $('#place').select2({
        placeholder: "Joyni tanlang",
        allowClear: true,
        theme: "bootstrap-5",
        minimumResultsForSearch: 0
    });

    $('#sale_type').select2({
        placeholder: "Tanlang",
        allowClear: true,
        theme: "bootstrap-5",
        minimumResultsForSearch: 0
    });
});
</script>

{% endblock content %}
